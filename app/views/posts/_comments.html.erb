<%comments.each do |comment|%>
  <%= one_comment(comment, comment.user)%>
<%end%>

<div id="comment_try"></div>
<%if can_edit? and (not defined?(support) or support.status!='close') %>
  <div>
    <% semantic_form_for :comment, @comment, :url => { :controller => 'main', :action => "comment_work", :do => 'add' } do |f| %>
      <% f.inputs :style => "border:0px;" do %>
        <%= f.hidden_field :user_id, :value => current_user.id %>
        <%if not @post.nil?%>
          <%= hidden_field 'blog','id', :value => @blog.id %>
          <%= f.hidden_field :post_id, :value => @post.id %>
        <%else%>
          <%= f.hidden_field :support_id, :value => @support.id %>
        <%end%>
        <%= textile_editor 'comment', 'text', :style=>"width:60%; height:200px;" -%>
      <%end%>
      <% f.buttons :style => "border:0px;" do %>
        <%= link_to "Подробнее о разметке текста", "http://ru.wikipedia.org/wiki/Textile_(%D1%8F%D0%B7%D1%8B%D0%BA_%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%82%D0%BA%D0%B8)" %>
        <%= f.commit_button :wrapper_html => { :style => 'display:block;' }, :label => "Сохранить"%>
      <% end %>
    <% end %>
  </div>

<%= observe_field(:comment_text,
  :frequency => 3,
  :update => :comment_try,
  :before => "Element.show('spinner')",
  :success => "Element.hide('spinner')",
  :url => { :controller=>'main', :action => 'comment_try' },
  :with => "'text=' + encodeURIComponent(value)") %>

<%end%>

<%= textile_editor_initialize -%>